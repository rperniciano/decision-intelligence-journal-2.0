<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toast Notification Test - Feature #227</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" crossorigin></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #0a0a0f;
            color: #f0f0f5;
            margin: 0;
            padding: 20px;
        }
        .test-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(26, 26, 46, 0.9);
            border: 1px solid rgba(0, 212, 170, 0.3);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            z-index: 1000;
        }
        button {
            padding: 12px 20px;
            background: #00d4aa;
            color: #0a0a0f;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }
        button:hover {
            background: #00b896;
            transform: translateY(-2px);
        }
        button.error { background: #ef4444; color: white; }
        button.error:hover { background: #dc2626; }
        button.info { background: #3b82f6; color: white; }
        button.info:hover { background: #2563eb; }
        button.rapid { background: #f59e0b; color: #0a0a0f; }
        button.rapid:hover { background: #d97706; }
    </style>
</head>
<body>
    <div id="root"></div>

    <div class="test-controls">
        <button onclick="triggerSingle('success')">Single Success Toast</button>
        <button onclick="triggerSingle('error')">Single Error Toast</button>
        <button onclick="triggerSingle('info')">Single Info Toast</button>
        <button onclick="triggerMultiple()">Trigger 5 Rapid Toasts</button>
        <button class="rapid" onclick="triggerRapidFire()">Rapid Fire (10 fast)</button>
    </div>

    <script type="text/babel" data-presets="react">
        const { useState, useCallback, createContext, useContext } = React;
        const { AnimatePresence, motion } = Motion;

        // Toast Context (copied from app)
        const ToastContext = createContext(undefined);

        function ToastProvider({ children }) {
            const [toasts, setToasts] = useState([]);

            const removeToast = useCallback((id) => {
                setToasts((prev) => prev.filter((toast) => toast.id !== id));
            }, []);

            const showToast = useCallback((message, type = 'success') => {
                const id = Date.now().toString() + Math.random();
                setToasts((prev) => [...prev, { id, message, type }]);
            }, []);

            const showSuccess = useCallback((message) => showToast(message, 'success'), [showToast]);
            const showError = useCallback((message) => showToast(message, 'error'), [showToast]);
            const showInfo = useCallback((message) => showToast(message, 'info'), [showToast]);

            // Make available globally for testing
            window.toastAPI = { showSuccess, showError, showInfo, showToast };

            return (
                <ToastContext.Provider value={{ showToast, showSuccess, showError, showInfo }}>
                    {children}
                    <div style={{
                        position: 'fixed',
                        top: '1rem',
                        left: 0,
                        right: 0,
                        zIndex: 50,
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'center',
                        gap: '1rem',
                        padding: '0 1rem',
                        pointerEvents: 'none'
                    }}>
                        <AnimatePresence>
                            {toasts.map((toast, index) => (
                                <Toast
                                    key={toast.id}
                                    message={toast.message}
                                    type={toast.type}
                                    onClose={() => removeToast(toast.id)}
                                    index={index}
                                />
                            ))}
                        </AnimatePresence>
                    </div>
                </ToastContext.Provider>
            );
        }

        function Toast({ message, type = 'success', onClose, duration = 3000, index = 0 }) {
            React.useEffect(() => {
                const timer = setTimeout(onClose, duration);
                return () => clearTimeout(timer);
            }, [onClose, duration]);

            const bgColors = {
                success: 'rgba(0, 212, 170, 0.2)',
                error: 'rgba(239, 68, 68, 0.2)',
                info: 'rgba(59, 130, 246, 0.2)',
            };

            const borderColors = {
                success: 'rgba(0, 212, 170, 0.5)',
                error: 'rgba(239, 68, 68, 0.5)',
                info: 'rgba(59, 130, 246, 0.5)',
            };

            const iconColors = {
                success: '#00d4aa',
                error: '#f87171',
                info: '#60a5fa',
            };

            const icons = {
                success: (
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                ),
                error: (
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                ),
                info: (
                    <svg width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
            };

            return (
                <motion.div
                    style={{
                        width: '100%',
                        maxWidth: '28rem',
                        background: bgColors[type],
                        border: `1px solid ${borderColors[type]}`,
                        backdropFilter: 'blur(20px)',
                        borderRadius: '1rem',
                        boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.5)',
                        padding: '1rem',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '0.75rem',
                        pointerEvents: 'auto',
                        pointerEvents: 'auto'
                    }}
                    initial={{ opacity: 0, y: -20, scale: 0.95 }}
                    animate={{ opacity: 1, y: 0, scale: 1 }}
                    exit={{ opacity: 0, y: -20, scale: 0.95 }}
                    transition={{ type: 'spring', stiffness: 400, damping: 25 }}
                    role="alert"
                    aria-live="polite"
                >
                    <div style={{ color: iconColors[type], flexShrink: 0 }}>
                        {icons[type]}
                    </div>
                    <p style={{ flex: 1, fontSize: '0.875rem', fontWeight: 500, margin: 0 }}>
                        {message}
                    </p>
                    <button
                        onClick={onClose}
                        style={{
                            flexShrink: 0,
                            width: '1.5rem',
                            height: '1.5rem',
                            borderRadius: '9999px',
                            background: 'rgba(255, 255, 255, 0.1)',
                            border: 'none',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center'
                        }}
                        aria-label="Close notification"
                    >
                        <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </motion.div>
            );
        }

        function App() {
            return (
                <div>
                    <h1>Feature #227: Notification Stacking Test</h1>
                    <p>Use the buttons below to test toast notification stacking behavior.</p>
                    <div style={{ marginTop: '100px' }}>
                        <h2>What to test:</h2>
                        <ul>
                            <li>✅ Multiple toasts trigger rapidly</li>
                            <li>✅ Toasts stack vertically (not overlapping)</li>
                            <li>✅ Each toast is readable</li>
                            <li>✅ Can dismiss individual toasts</li>
                            <li>✅ Proper gap between toasts (gap-4 = 1rem)</li>
                        </ul>
                    </div>
                </div>
            );
        }

        // Global functions for button clicks
        window.triggerSingle = (type) => {
            if (window.toastAPI) {
                window.toastAPI[`show${type.charAt(0).toUpperCase() + type.slice(1)}`](
                    `This is a ${type} notification`
                );
            }
        };

        window.triggerMultiple = () => {
            if (window.toastAPI) {
                const types = ['success', 'error', 'info'];
                for (let i = 1; i <= 5; i++) {
                    setTimeout(() => {
                        const type = types[i % 3];
                        window.toastAPI[`show${type.charAt(0).toUpperCase() + type.slice(1)}`](
                            `Notification #${i} - ${type.toUpperCase()}`
                        );
                    }, i * 100);
                }
            }
        };

        window.triggerRapidFire = () => {
            if (window.toastAPI) {
                const types = ['success', 'error', 'info'];
                for (let i = 1; i <= 10; i++) {
                    setTimeout(() => {
                        const type = types[i % 3];
                        window.toastAPI[`show${type.charAt(0).toUpperCase() + type.slice(1)}`](
                            `Rapid fire #${i} - ${type.toUpperCase()}`
                        );
                    }, i * 50);
                }
            }
        };

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <ToastProvider>
                <App />
            </ToastProvider>
        );
    </script>
</body>
</html>
