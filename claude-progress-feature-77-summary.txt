================================================================================
FEATURE #77: MULTIPLE CHECK-INS TRACKED SEPARATELY - IMPLEMENTATION SUMMARY
================================================================================

Date: 2026-01-20
Feature ID: 77
Category: Real Data Verification
Name: Multiple check-ins tracked separately
Status: ðŸ”„ IN PROGRESS - Database table needs to be created

================================================================================
REQUIREMENT
================================================================================

Verify that multiple check-ins (outcomes) for the same decision are tracked
separately with unique check_in_number values (1st, 2nd, 3rd, etc.)

Test Steps:
1. Create and complete a decision
2. Record first outcome
3. Wait/trigger another check-in
4. Record second outcome
5. View decision detail
6. Verify both check-ins visible with numbers (1st, 2nd)

================================================================================
CURRENT STATE
================================================================================

Current Implementation:
- Outcomes stored as columns on decisions table (outcome, outcome_notes, outcome_recorded_at)
- Only ONE outcome per decision supported
- No outcomes table exists
- No check_in_number tracking

Required Implementation:
âœ… 1. Create outcomes table (SQL migration created but not executed)
âŒ 2. Update API endpoints to use outcomes table
âŒ 3. Update UI to display multiple check-ins
âŒ 4. Test end-to-end

================================================================================
DATABASE MIGRATION REQUIRED
================================================================================

File: apps/api/migrations/create_outcomes_table.sql

SQL to run in Supabase SQL Editor:
https://supabase.com/dashboard/project/doqojfsldvajmlscpwhu/sql

-- Create outcomes table for multiple check-ins per decision (Feature #77)
CREATE TABLE IF NOT EXISTS public.outcomes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  decision_id UUID NOT NULL REFERENCES public.decisions(id) ON DELETE CASCADE,
  result VARCHAR(20) NOT NULL CHECK (result IN ('better', 'as_expected', 'worse')),
  satisfaction SMALLINT CHECK (satisfaction >= 1 AND satisfaction <= 5),
  reflection_audio_url TEXT,
  reflection_transcript TEXT,
  learned TEXT,
  scheduled_for DATE,
  recorded_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  check_in_number SMALLINT NOT NULL DEFAULT 1,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Indexes
CREATE INDEX IF NOT EXISTS idx_outcomes_decision ON public.outcomes(decision_id);
CREATE INDEX IF NOT EXISTS idx_outcomes_check_in ON public.outcomes(decision_id, check_in_number);

-- Enable RLS
ALTER TABLE public.outcomes ENABLE ROW LEVEL SECURITY;

-- RLS Policies
CREATE POLICY "Users can view outcomes for own decisions"
  ON public.outcomes FOR SELECT USING (decision_id IN (SELECT id FROM public.decisions WHERE user_id = auth.uid()));

CREATE POLICY "Users can insert outcomes for own decisions"
  ON public.outcomes FOR INSERT WITH CHECK (decision_id IN (SELECT id FROM public.decisions WHERE user_id = auth.uid()));

CREATE POLICY "Users can update outcomes for own decisions"
  ON public.outcomes FOR UPDATE USING (decision_id IN (SELECT id FROM public.decisions WHERE user_id = auth.uid()));

CREATE POLICY "Users can delete outcomes for own decisions"
  ON public.outcomes FOR DELETE USING (decision_id IN (SELECT id FROM public.decisions WHERE user_id = auth.uid()));

================================================================================
NEXT STEPS
================================================================================

1. Execute the SQL migration in Supabase SQL Editor
2. Update API endpoints in server.ts:
   - GET /api/v1/decisions/:id/outcomes - Query from outcomes table
   - POST /api/v1/decisions/:id/outcomes - Insert to outcomes table with check_in_number
3. Update DecisionDetailPage.tsx:
   - Display multiple outcomes as a list/timeline
   - Show "1st check-in", "2nd check-in" labels
   - Each outcome shows result, satisfaction, date
4. Create test data with 2+ check-ins
5. Verify via browser automation
6. Mark feature as passing

================================================================================
BLOCKER
================================================================================

âš ï¸  Cannot proceed without database table creation.
Need to execute SQL migration manually in Supabase dashboard.

================================================================================
