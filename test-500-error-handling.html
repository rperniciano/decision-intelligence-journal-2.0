<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test 500 Error Handling</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #0a0a0f;
            color: #f0f0f5;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #00d4aa;
            border-radius: 8px;
            background: rgba(0, 212, 170, 0.1);
        }
    </style>
</head>
<body>
    <h1>Feature #107 Test: API 500 Error Handling</h1>

    <p>This test verifies that when a 500 error occurs, the app:</p>
    <ul>
        <li>✅ Does NOT show technical stack traces</li>
        <li>✅ Shows a friendly "Something went wrong" message</li>
        <li>✅ Provides guidance to retry or contact support</li>
    </ul>

    <button onclick="test500Error()">Trigger 500 Error Test</button>
    <button onclick="testNetworkError()">Trigger Network Error Test</button>

    <div id="result"></div>

    <script>
        // Error handling utility functions (from errorHandling.ts)
        function isNetworkError(error) {
            if (error instanceof TypeError) {
                const message = error.message.toLowerCase();
                return (
                    message.includes('failed to fetch') ||
                    message.includes('network') ||
                    message.includes('connection')
                );
            }
            return false;
        }

        function getFriendlyErrorMessage(error) {
            // Network errors
            if (isNetworkError(error)) {
                return 'Unable to connect. Please check your internet connection and try again.';
            }

            // HTTP errors
            if (error instanceof Error) {
                const message = error.message;

                if (message.includes('401') || message.includes('Unauthorized')) {
                    return 'Your session has expired. Please log in again.';
                }

                if (message.includes('403') || message.includes('Forbidden')) {
                    return 'You don\\'t have permission to access this resource.';
                }

                if (message.includes('404') || message.includes('Not found')) {
                    return 'The requested resource was not found.';
                }

                if (message.includes('500') || message.includes('Internal server')) {
                    return 'Something went wrong on our end. Please try again later.';
                }
            }

            // Generic fallback
            return 'An unexpected error occurred. Please try again.';
        }

        function showErrorAlert(error, context) {
            const friendlyMessage = getFriendlyErrorMessage(error);
            const fullMessage = context
                ? `${context}: ${friendlyMessage}`
                : friendlyMessage;

            document.getElementById('result').innerHTML = `
                <h3>Error Display Test Result:</h3>
                <p><strong>Alert message that would be shown:</strong></p>
                <p style="background: #1a1a2e; padding: 10px; border-left: 3px solid #00d4aa;">${fullMessage}</p>
                <h4>✅ Pass Criteria:</h4>
                <ul>
                    <li>✅ No technical stack trace visible</li>
                    <li>✅ Friendly, non-technical language</li>
                    <li>✅ Guidance provided (e.g., "try again later")</li>
                </ul>
                <p><em>Note: In the actual app, this would be shown as an alert() dialog.</em></p>
            `;

            // Also show alert like in real app
            alert(fullMessage);
        }

        function test500Error() {
            const error = new Error('500 Internal server error');
            showErrorAlert(error, 'Failed to load data');
        }

        function testNetworkError() {
            const error = new TypeError('Failed to fetch');
            showErrorAlert(error, 'Failed to load data');
        }
    </script>
</body>
</html>
