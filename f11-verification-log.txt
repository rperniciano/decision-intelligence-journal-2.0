================================================================================
[REGRESSION TEST] Feature #11 - Invalid auth token rejected
Date: 2026-01-20
Status: ✅ VERIFIED WORKING

Feature Description:
-------------------
Verify that malformed, invalid, or missing authentication tokens are properly
rejected with appropriate error messages and no sensitive data exposure.

Test Results:
-------------
✅ Test 1: Malformed JWT token
   - Request: GET /api/v1/decisions with "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.invalid"
   - Response: 401 Unauthorized
   - Body: {"error":"Unauthorized","message":"Invalid or expired token"}

✅ Test 2: Random garbage token
   - Request: GET /api/v1/decisions with "Bearer completely-random-garbage-token-xyz123"
   - Response: 401 Unauthorized
   - Body: {"error":"Unauthorized","message":"Invalid or expired token"}

✅ Test 3: Empty token
   - Request: GET /api/v1/decisions with "Bearer " (empty token)
   - Response: 401 Unauthorized
   - Body: {"error":"Unauthorized","message":"Missing or invalid authorization header"}

✅ Test 4: No Authorization header
   - Request: GET /api/v1/decisions without any Authorization header
   - Response: 401 Unauthorized
   - Body: {"error":"Unauthorized","message":"Missing or invalid authorization header"}

✅ Test 5: Expired token format
   - Request: GET /api/v1/decisions with expired-looking JWT
   - Response: 401 Unauthorized
   - Body: {"error":"Unauthorized","message":"Invalid or expired token"}

Security Verification:
---------------------
✅ All invalid tokens return 401 status
✅ No sensitive data exposed in error responses
✅ Error messages are generic (don't reveal system details)
✅ Consistent error format across all scenarios
✅ No stack traces or internal errors exposed

Implementation Details:
----------------------
Auth middleware (apps/api/src/middleware/auth.ts):
- Lines 48-56: Checks for missing/invalid Authorization header
- Lines 77-83: Verifies JWT token with Supabase and rejects invalid tokens
- Lines 91-96: Catches any auth errors and returns 401

All /api/v1 routes are protected by authMiddleware (server.ts line 173).

Browser Testing:
---------------
✅ Tested via fetch API from browser
✅ All requests properly rejected with 401
✅ Console shows appropriate 401 errors
✅ No data leaks in browser console or network tab

Conclusion:
-----------
Feature #11 is WORKING CORRECTLY

The authentication middleware properly rejects:
- Missing Authorization headers
- Malformed JWT tokens
- Invalid/garbage tokens
- Expired tokens

All responses:
- Return HTTP 401 status code
- Provide appropriate error messages
- Do not expose sensitive data
- Follow consistent error format

Screenshot: .playwright-mcp/verification/f11-invalid-auth-verified.png

Progress: 278/291 passing (95.5%)
================================================================================
